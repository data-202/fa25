---
title: "DATA 202 - Analysis of Yahoo! News Poll"
author: "FirstName LastName"
date: "Week 7"
output: html_document
editor_options:
    chunk_output_type: console
---

```{r setup, include=F}
knitr:: opts_chunk$set(echo = TRUE)
```

# Libraries and packages

Load the libraries we needed. Be sure to `install.packages()` where needed.

```{r}
library(critstats)
library(tidyverse)
library(ggplot2)
library(dplyr)
```

# Yahoo! News Poll

The Yahoo! News Race and Justice poll was conducted in 2020 after the killing of George Floyd. There is pre-loaded data set located in R. A complete description of the data is as follows:

> Results from a Yahoo! News poll conducted by YouGov on May 29-31, 2020. In total 1060 U.S. adults were asked a series of questions regarding race and justice in the wake of the killing of George Floyd by a police officer. Results in this data set are percentages for the question, “Do you think Blacks and Whites receive equal treatment from the police?” For this particular question there were 1059 respondents.

# Data

## Load the data from github

We'll use data on the gender pay gap that I have prepared for today's discussion.

```{r}
yahoo <- critstats::yahoo_data
```

## View

View a summary of the data.

```{r}
summary(yahoo)
```

Alternatively, you can use `View(yaho)` to see the data frame in a separate window.

# Explore

## Glimpse

Take a glimpse of the data.

```{r}
glimpse(yahoo)
```

## Head / Tail

View the top (head) and bottom (tail) of the data.

```{r}
head(yahoo)
tail(yahoo)
```

## Counts and proportions

Create a table of variable counts.

```{r}
table(yahoo$race_eth)
table(yahoo$response)
```

Create a table of variable proportions

```{r}
prop.table(table(yahoo$race_eth))
prop.table(table(yahoo$response))
```

## Visualize

Start with the plot outline.

```{r}
ggplot(yahoo)
```

Add the variable categories to the plot using aesthetics (aes).

```{r}
ggplot(yahoo, aes(x = race_eth))
```

Add bars to the plot using plus (+) geom_bar().

```{r}
ggplot(yahoo, aes(x = race_eth)) +
  geom_bar()
```

We can improve this plot with some additional code.

```{r}
ggplot(yahoo, aes(x = race_eth, fill = race_eth)) +
  geom_bar(width = 0.7, color = "black") +
  scale_fill_brewer(palette = "Set2") +
  labs(x = "Race/Ethnicity", y = "Count", title = "Distribution of Race/Ethnicity") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none",
    plot.title = element_text(hjust = 0.5, face = "bold")
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.1)))
```

We can also add counts to our bars.

```{r}
ggplot(yahoo, aes(x = race_eth, fill = race_eth)) +
  geom_bar(width = 0.7, color = "black") +
  geom_text(stat = "count", aes(label = after_stat(count)), 
            vjust = -0.5, color = "black", size = 3.5) +
  scale_fill_brewer(palette = "Set2") +
  labs(x = "Race/Ethnicity", y = "Count", title = "Distribution of Race/Ethnicity") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "none",
    plot.title = element_text(hjust = 0.5, face = "bold")
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15)))
```

------------------------------------------------------------------------

# Analysis

Load the descr and Hmisc libraries. Install packages as needed.

`descr` and `Hmisc` contain useful functions to analyze social science data.

```{r}
#install.packages("descr")
#install.packages("Hmisc")
library(descr)
library(Hmisc)
```

Pass the Yahoo! News Poll data frame to `df`.

```{r}
df <- yahoo # set the yahoo_data to df
```

Rename the `race_eth` variable to `race`.

```{r}
df <- df %>% 
  rename("race" = "race_eth") # rename the race_eth variable to race
```

## Sample size

Get a count of the sample size.

```{r}
count(df)
```

## Relative frequencies

Get relative frequencies by the `race` variable.

```{r}
df %>% 
  count(race) %>% 
  mutate(prop = prop.table(n))
```

Get relative frequencies by the `responce` variable.

```{r}
df %>% 
  count(response) %>% 
  mutate(prop = prop.table(n))
```

## Crosstab

Get a crosstab of the `race` and `response` variables.

```{r}
crosstab(df$response, df$race, plot=F)
```

Standardize the frequencies.

```{r}
crosstab(df$response, df$race, plot=F, prop.c=T)
```

Create a crosstab with raw frequencies.

```{r}
crosstab(df$response, df$race, plot=F)
```

Gather the expected values.

```{r}
crosstab(df$response, df$race,
         expected=T, #Add expected frequency to each cell
         plot=F)
```

Add the chi-square contributions.

```{r}
crosstab(df$response, df$race,
         expected=T, #Add expected frequency to each cell
         prop.chisq = T, #Total contribution of each cell 
         plot=F)
```

Calculate your degrees of freedom:

$$ 
df_{\chi^2} = (r-1)(c-1)
$$ Where `r` equals the number of rows and `c` equals the number of columns.

In our case we have $r = 3$ and $c=4$, so we get:

$$ 
df_{\chi^2} = (3-1)(4-1) = (2)(3) = 6
$$

Use the chi-square critical values.

Gather the critical value of chi-square.

```{r}
qchisq(.05, 6, lower.tail=F)
```

Take note of the $6$ in our code; that will change based on your analysis.

Get the chi-square statistic.

```{r}
chisq.test(df$response, df$race)
```

From here you want to critically interpret your values.
